<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>MoodAtlas</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="MoodAtlas.styles.css" />
    <link rel="icon" href="data:,">
    
    <!-- Google Fonts with Emoji Support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    
    <style>
        /* Emoji Font Stack */
        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
        
        /* Ensure emojis display properly */
        .emoji, [data-emoji] {
            font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', sans-serif;
            font-style: normal;
        }
    </style>
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>

    <script>
        // Theme Management
        function applyTheme(isDarkMode) {
            const root = document.documentElement;
            if (isDarkMode) {
                root.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                root.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        }

        // Load theme on page load
        window.addEventListener('DOMContentLoaded', (event) => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        });

        // Tab switching function
        function switchTab(tabId) {
            const tab = document.getElementById(tabId);
            if (tab) {
                const bootstrapTab = new bootstrap.Tab(tab);
                bootstrapTab.show();
            }
        }

        // File download function
        function downloadFile(filePath, fileName) {
            var link = document.createElement('a');
            link.href = filePath;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // File upload trigger
        function triggerFileUpload(inputId) {
            document.getElementById(inputId).click();
        }

        // Clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function () {
                alert('Copied to clipboard!');
            }, function (err) {
                console.error('Could not copy text: ', err);
            });
        }

        // Confirmation dialog
        function showConfirmation(message) {
            return confirm(message);
        }
        
        // Simple markdown to HTML converter
        function renderMarkdown(text) {
            if (!text) return '';
            
            // Bold: **text** or __text__
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');
            
            // Italic: *text* or _text_
            text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
            text = text.replace(/_(.+?)_/g, '<em>$1</em>');
            
            // Line breaks
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        // Get text selection from textarea for rich text editor
        function getTextSelection(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (!textarea) {
                return { start: -1, end: -1, text: '' };
            }
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value.substring(start, end);
            
            return { start: start, end: end, text: text };
        }

        // Set cursor position in textarea
        function setTextareaCursor(textareaId, position) {
            const textarea = document.getElementById(textareaId);
            if (textarea) {
                textarea.focus();
                textarea.setSelectionRange(position, position);
            }
        }

        // Insert text at cursor position in textarea
        function insertTextAtCursor(textareaId, text) {
            const textarea = document.getElementById(textareaId);
            if (!textarea) return;
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const before = textarea.value.substring(0, start);
            const after = textarea.value.substring(end);
            
            textarea.value = before + text + after;
            textarea.focus();
            
            const newPos = start + text.length;
            textarea.setSelectionRange(newPos, newPos);
            
            // Trigger input event for Blazor binding
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
        }
    </script>

</body>

</html>